import{U as x,d as u}from"./chunk-DCPYCCPN.js";var y=class h{constructor(){}extractTextStreamAsJson(t){return u(this,null,function*(){try{console.log("\u{1F4C4} PDF \uD14D\uC2A4\uD2B8 \uC2A4\uD2B8\uB9BC \uCD94\uCD9C \uC2DC\uC791:",t.name);let e={fileName:t.name,fileSize:t.size,pageCount:0,extractionTimestamp:new Date().toISOString(),extractionMethod:"PDF.js + \uD5A5\uC0C1\uB41C \uBD84\uC11D",pages:[],metadata:{totalTextItems:0,totalWords:0,totalCharacters:0,uniqueFonts:[],hasImages:!1,hasVectorGraphics:!1}},n=yield t.arrayBuffer();if(typeof window.pdfjsLib<"u"){let o=window.pdfjsLib;o.GlobalWorkerOptions.workerSrc||(o.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js");let a=yield o.getDocument({data:n}).promise;e.pageCount=a.numPages,console.log(`\u{1F4CA} \uCD1D \uD398\uC774\uC9C0 \uC218: ${a.numPages}`);let r=new Set,l=0,d=0,f=0;for(let c=1;c<=a.numPages;c++){console.log(`\u{1F4C4} \uD398\uC774\uC9C0 ${c} \uCC98\uB9AC \uC911...`);let w=yield a.getPage(c),p=w.getViewport({scale:1}),m=(yield w.getTextContent()).items.map((i,C)=>{let g=i.transform,I={id:`page-${c}-item-${C}`,text:i.str,position:{x:Math.round(g[4]*100)/100,y:Math.round((p.height-g[5])*100)/100,width:Math.round(i.width*100)/100,height:Math.round(i.height*100)/100},font:{name:i.fontName||"Unknown",size:Math.round(Math.abs(g[0])*100)/100},transform:g,style:{direction:i.dir||"ltr",hasEndOfLine:i.hasEOL||!1},analysis:this.analyzeText(i.str)};return i.fontName&&r.add(i.fontName),I}).filter(i=>i.text.trim().length>0),S=this.groupTextIntoSentences(m),b=this.calculatePageStatistics(m),T={pageNumber:c,width:Math.round(p.width),height:Math.round(p.height),textItems:m,sentences:S,statistics:b};e.pages.push(T),l+=m.length,d+=b.wordCount,f+=b.charCount}return e.metadata={totalTextItems:l,totalWords:d,totalCharacters:f,uniqueFonts:Array.from(r),hasImages:yield this.checkForImages(a),hasVectorGraphics:yield this.checkForVectorGraphics(a)},console.log("\u2705 \uD14D\uC2A4\uD2B8 \uC2A4\uD2B8\uB9BC \uCD94\uCD9C \uC644\uB8CC"),console.log(`\u{1F4CA} \uD1B5\uACC4: ${l}\uAC1C \uD14D\uC2A4\uD2B8 \uC544\uC774\uD15C, ${d}\uAC1C \uB2E8\uC5B4, ${f}\uAC1C \uBB38\uC790`),e}throw new Error("PDF.js \uB77C\uC774\uBE0C\uB7EC\uB9AC\uB97C \uC0AC\uC6A9\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4")}catch(e){throw console.error("\u274C \uD14D\uC2A4\uD2B8 \uC2A4\uD2B8\uB9BC \uCD94\uCD9C \uC624\uB958:",e),e}})}analyzeText(t){let e=t.trim().split(/\s+/).filter(o=>o.length>0).length,n=t.length;return{wordCount:e,charCount:n,containsEnglish:/[a-zA-Z]/.test(t),containsKorean:/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(t),containsNumbers:/[0-9]/.test(t),containsSpecialChars:/[!@#$%^&*(),.?":{}|<>]/.test(t)}}groupTextIntoSentences(t){let e=[],n={text:"",items:[],x:null,y:null,width:0,height:0};return t.forEach((o,s)=>{if(n.x===null&&(n.x=o.position.x,n.y=o.position.y),n.text+=o.text,n.items.push(o),n.width+=o.position.width,n.height=Math.max(n.height,o.position.height),(o.style.hasEndOfLine||o.text.includes(".")||o.text.includes("!")||o.text.includes("?")||s===t.length-1)&&n.text.trim()){let r=n.text.trim();e.push({id:`sentence-${e.length+1}`,text:r,position:{x:n.x||0,y:n.y||0,width:n.width,height:n.height},itemCount:n.items.length,itemIds:n.items.map(l=>l.id),language:this.detectLanguage(r)}),n={text:"",items:[],x:null,y:null,width:0,height:0}}}),e}detectLanguage(t){let e=/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(t),n=/[a-zA-Z]/.test(t);return e&&n?"mixed":e?"korean":n?"english":"unknown"}calculatePageStatistics(t){let e=t.reduce((a,r)=>a+r.analysis.wordCount,0),n=t.reduce((a,r)=>a+r.analysis.charCount,0),o=t.length>0?t.reduce((a,r)=>a+r.font.size,0)/t.length:0,s={};return t.forEach(a=>{s[a.font.name]=(s[a.font.name]||0)+1}),{totalItems:t.length,wordCount:e,charCount:n,avgFontSize:Math.round(o*100)/100,fontDistribution:s}}checkForImages(t){return u(this,null,function*(){try{for(let e=1;e<=t.numPages;e++){let o=yield(yield t.getPage(e)).getOperatorList();for(let s=0;s<o.fnArray.length;s++){let a=o.fnArray[s];if(a===window.pdfjsLib.OPS.paintImageXObject||a===window.pdfjsLib.OPS.paintInlineImageXObject)return!0}}}catch(e){console.warn("\uC774\uBBF8\uC9C0 \uD655\uC778 \uC911 \uC624\uB958:",e)}return!1})}checkForVectorGraphics(t){return u(this,null,function*(){try{for(let e=1;e<=t.numPages;e++){let o=yield(yield t.getPage(e)).getOperatorList();for(let s=0;s<o.fnArray.length;s++){let a=o.fnArray[s];if(a===window.pdfjsLib.OPS.moveTo||a===window.pdfjsLib.OPS.lineTo||a===window.pdfjsLib.OPS.curveTo||a===window.pdfjsLib.OPS.rectangle||a===window.pdfjsLib.OPS.fill||a===window.pdfjsLib.OPS.stroke)return!0}}}catch(e){console.warn("\uBCA1\uD130 \uADF8\uB798\uD53D \uD655\uC778 \uC911 \uC624\uB958:",e)}return!1})}downloadJsonData(t){try{let e=JSON.stringify(t,null,2),n=new Blob([e],{type:"application/json;charset=utf-8;"}),o=document.createElement("a"),s=URL.createObjectURL(n),a=new Date().toISOString().split("T")[0],r=`${t.fileName}_text_stream_${a}.json`;o.setAttribute("href",s),o.setAttribute("download",r),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s),console.log(`\u2705 JSON \uD30C\uC77C \uB2E4\uC6B4\uB85C\uB4DC \uC644\uB8CC: ${r}`)}catch(e){throw console.error("\u274C JSON \uD30C\uC77C \uB2E4\uC6B4\uB85C\uB4DC \uC624\uB958:",e),e}}logJsonData(t){console.group("\u{1F4C4} PDF \uD14D\uC2A4\uD2B8 \uC2A4\uD2B8\uB9BC JSON \uB370\uC774\uD130"),console.log("\u{1F4CA} \uAE30\uBCF8 \uC815\uBCF4:",{fileName:t.fileName,fileSize:t.fileSize,pageCount:t.pageCount,extractionTimestamp:t.extractionTimestamp}),console.log("\u{1F4C8} \uD1B5\uACC4:",t.metadata),console.log("\uFFFD \uC5B8\uC5B4 \uD1B5\uACC4:",t.metadata.languageDetection),console.log("\uFFFD\u{1F4DD} \uD398\uC774\uC9C0\uBCC4 \uC694\uC57D:",t.pages.map(e=>({page:e.pageNumber,textItems:e.statistics.totalItems,words:e.statistics.wordCount,englishCount:e.statistics.englishTextCount||0,koreanCount:e.statistics.koreanTextCount||0}))),console.log("\u{1F4C4} \uC804\uCCB4 JSON \uB370\uC774\uD130:",t),console.groupEnd()}processFileWithAutoExtraction(t){return u(this,null,function*(){try{console.log("\u{1F680} PDF \uD30C\uC77C \uCC98\uB9AC \uC2DC\uC791 (\uC790\uB3D9 \uD14D\uC2A4\uD2B8 \uC2A4\uD2B8\uB9BC \uCD94\uCD9C):",t.name);let e=yield this.extractTextStreamAsJson(t);this.logJsonData(e);let n=this.generateSummary(e);return console.log(`\u{1F4CB} \uC694\uC57D \uC815\uBCF4:
`+n),e}catch(e){throw console.error("\u274C PDF \uD30C\uC77C \uCC98\uB9AC \uC2E4\uD328:",e),e}})}filterTextByCondition(t,e){let n=[];return t.pages.forEach(o=>{e.pageNumber&&o.pageNumber!==e.pageNumber||o.textItems.forEach(s=>{let a=!0;e.containsEnglish!==void 0&&(a=a&&s.analysis.containsEnglish===e.containsEnglish),e.containsKorean!==void 0&&(a=a&&s.analysis.containsKorean===e.containsKorean),e.minFontSize!==void 0&&(a=a&&s.font.size>=e.minFontSize),e.maxFontSize!==void 0&&(a=a&&s.font.size<=e.maxFontSize),a&&n.push(s)})}),n}generateSummary(t){return[`\u{1F4C4} PDF \uD30C\uC77C: ${t.fileName}`,"\u{1F4CA} \uAE30\uBCF8 \uC815\uBCF4:",`   - \uD30C\uC77C \uD06C\uAE30: ${this.formatFileSize(t.fileSize)}`,`   - \uD398\uC774\uC9C0 \uC218: ${t.pageCount}`,`   - \uCD94\uCD9C \uC2DC\uAC04: ${new Date(t.extractionTimestamp).toLocaleString("ko-KR")}`,"","\u{1F4C8} \uD14D\uC2A4\uD2B8 \uD1B5\uACC4:",`   - \uCD1D \uD14D\uC2A4\uD2B8 \uC544\uC774\uD15C: ${t.metadata.totalTextItems.toLocaleString()}\uAC1C`,`   - \uCD1D \uB2E8\uC5B4 \uC218: ${t.metadata.totalWords.toLocaleString()}\uAC1C`,`   - \uCD1D \uBB38\uC790 \uC218: ${t.metadata.totalCharacters.toLocaleString()}\uAC1C`,`   - \uC0AC\uC6A9\uB41C \uD3F0\uD2B8: ${t.metadata.uniqueFonts.length}\uAC1C`,"","\u{1F5BC}\uFE0F \uBBF8\uB514\uC5B4 \uC694\uC18C:",`   - \uC774\uBBF8\uC9C0 \uD3EC\uD568: ${t.metadata.hasImages?"\uC608":"\uC544\uB2C8\uC624"}`,`   - \uBCA1\uD130 \uADF8\uB798\uD53D \uD3EC\uD568: ${t.metadata.hasVectorGraphics?"\uC608":"\uC544\uB2C8\uC624"}`,"","\u{1F4DD} \uD398\uC774\uC9C0\uBCC4 \uC0C1\uC138:",...t.pages.map(n=>`   \uD398\uC774\uC9C0 ${n.pageNumber}: ${n.statistics.totalItems}\uAC1C \uD14D\uC2A4\uD2B8, ${n.statistics.wordCount}\uB2E8\uC5B4`)].join(`
`)}formatFileSize(t){if(t===0)return"0 Bytes";let e=1024,n=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,o)).toFixed(2))+" "+n[o]}static \u0275fac=function(e){return new(e||h)};static \u0275prov=x({token:h,factory:h.\u0275fac,providedIn:"root"})};export{y as a};
