import{P as L,a as N,b as H,c as T}from"./chunk-322MATBB.js";var E=class R{fontData=null;constructor(){this.loadKoreanFont()}parseColor(r){let e={r:0,g:0,b:0};if(!r)return e;if(r.startsWith("#")){let c=r.slice(1);if(c.length===6)return{r:parseInt(c.slice(0,2),16)/255,g:parseInt(c.slice(2,4),16)/255,b:parseInt(c.slice(4,6),16)/255};if(c.length===3)return{r:parseInt(c[0]+c[0],16)/255,g:parseInt(c[1]+c[1],16)/255,b:parseInt(c[2]+c[2],16)/255}}let l=r.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*[\d.]+)?\)/);return l?{r:parseInt(l[1])/255,g:parseInt(l[2])/255,b:parseInt(l[3])/255}:{black:{r:0,g:0,b:0},white:{r:1,g:1,b:1},red:{r:1,g:0,b:0},green:{r:0,g:1,b:0},blue:{r:0,g:0,b:1},yellow:{r:1,g:1,b:0},cyan:{r:0,g:1,b:1},magenta:{r:1,g:0,b:1},gray:{r:.5,g:.5,b:.5},grey:{r:.5,g:.5,b:.5}}[r.toLowerCase()]||e}loadKoreanBoldFont(){return T(this,null,function*(){try{let r=yield fetch("/fonts/NanumGothic-Bold.ttf");if(r.ok){let e=yield r.arrayBuffer();return console.log("\uB85C\uCEEC \uB098\uB214\uACE0\uB515 Bold \uD3F0\uD2B8 \uB85C\uB4DC \uC131\uACF5"),e}}catch(r){console.log("\uB85C\uCEEC Bold \uD3F0\uD2B8 \uB85C\uB4DC \uC2E4\uD328:",r)}try{let r=yield fetch("https://github.com/google/fonts/raw/main/ofl/nanumgothic/NanumGothic-Bold.ttf");if(r.ok){let e=yield r.arrayBuffer();return console.log("GitHub \uB098\uB214\uACE0\uB515 Bold \uD3F0\uD2B8 \uB85C\uB4DC \uC131\uACF5"),e}}catch(r){console.log("GitHub Bold \uD3F0\uD2B8 \uB85C\uB4DC \uC2E4\uD328:",r)}return console.log("Bold \uD3F0\uD2B8 \uB85C\uB4DC \uC2E4\uD328, \uC77C\uBC18 \uD3F0\uD2B8 \uC0AC\uC6A9"),null})}loadKoreanFont(){return T(this,null,function*(){if(this.fontData)return!0;try{let r=yield fetch("/fonts/NanumGothic-Regular.ttf");if(r.ok)return this.fontData=yield r.arrayBuffer(),console.log("\uB85C\uCEEC \uB098\uB214\uACE0\uB515 \uD3F0\uD2B8 \uB85C\uB4DC \uC131\uACF5"),!0}catch(r){console.log("\uB85C\uCEEC \uD3F0\uD2B8 \uB85C\uB4DC \uC2E4\uD328:",r)}try{let r=yield fetch("https://github.com/google/fonts/raw/main/ofl/nanumgothic/NanumGothic-Regular.ttf");if(r.ok)return this.fontData=yield r.arrayBuffer(),console.log("GitHub \uB098\uB214\uACE0\uB515 \uD3F0\uD2B8 \uB85C\uB4DC \uC131\uACF5"),!0}catch(r){console.log("GitHub \uD3F0\uD2B8 \uB85C\uB4DC \uC2E4\uD328:",r)}try{let r=yield fetch("https://cdn.jsdelivr.net/gh/google/fonts@main/ofl/nanumgothic/NanumGothic-Regular.ttf");if(r.ok)return this.fontData=yield r.arrayBuffer(),console.log("jsdelivr \uB098\uB214\uACE0\uB515 \uD3F0\uD2B8 \uB85C\uB4DC \uC131\uACF5"),!0}catch(r){console.log("jsdelivr \uD3F0\uD2B8 \uB85C\uB4DC \uC2E4\uD328:",r)}return!1})}waitForPDFLib(){return T(this,null,function*(){return new Promise((r,e)=>{if(window.PDFLib&&window.fontkit){r(window.PDFLib);return}let l=1e4,o=100,c=0,i=()=>{window.PDFLib&&window.fontkit?r(window.PDFLib):c>=l?e(new Error("PDF-lib \uB610\uB294 fontkit \uB77C\uC774\uBE0C\uB7EC\uB9AC \uB85C\uB4DC \uC2DC\uAC04 \uCD08\uACFC. \uD398\uC774\uC9C0\uB97C \uC0C8\uB85C\uACE0\uCE68\uD574\uC8FC\uC138\uC694.")):(c+=o,setTimeout(i,o))};i()})})}overlayBackgroundOnAllText(c,i){return T(this,arguments,function*(r,e,l={r:1,g:1,b:1},o=1){try{console.log("\uBAA8\uB4E0 \uD14D\uC2A4\uD2B8 \uC704\uC5D0 \uBC30\uACBD\uC0C9 \uB808\uC774\uC5B4 \uADF8\uB9AC\uAE30 \uC2DC\uC791...");let n=yield this.waitForPDFLib(),s=yield r.arrayBuffer(),f=yield n.PDFDocument.load(s);console.log("PDF \uBB38\uC11C \uB85C\uB4DC \uC644\uB8CC, \uD398\uC774\uC9C0 \uC218:",f.getPageCount());let h=[],u=0;for(let m of e.pages)if(m.textItems.length>0){let B=m.pageNumber-1;if(B<f.getPageCount()){let v=f.getPages()[B];console.log(`\uD398\uC774\uC9C0 ${m.pageNumber}: \uD14D\uC2A4\uD2B8 \uC704\uC5D0 \uBC30\uACBD\uC0C9 \uB808\uC774\uC5B4 \uCD94\uAC00`);for(let x of m.textItems)if(x.text&&x.text.trim().length>0)try{let P=x.position,$=x.transform,d=$[4],F=$[5],w=P.width,a=Math.abs($[0]),y=a*1.2,g=a*.2;v.drawRectangle({x:d-2,y:F-g,width:w+4,height:y,color:n.rgb(l.r,l.g,l.b),opacity:o*.7,borderColor:n.rgb(1,0,0),borderWidth:.5,borderOpacity:.8}),u++}catch(P){console.warn(`\uD398\uC774\uC9C0 ${m.pageNumber}\uC758 \uD14D\uC2A4\uD2B8 \uC624\uBC84\uB808\uC774 \uC2E4\uD328:`,P)}h.push(m.pageNumber),console.log(`\uD398\uC774\uC9C0 ${m.pageNumber}\uC5D0 \uBC30\uACBD\uC0C9 \uC624\uBC84\uB808\uC774 \uCD94\uAC00 \uC644\uB8CC`)}}if(u===0)return{success:!1,removedCount:0,modifiedPages:[],error:"\uC624\uBC84\uB808\uC774\uD560 \uD14D\uC2A4\uD2B8\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4."};console.log("\uBC30\uACBD\uC0C9 \uC624\uBC84\uB808\uC774\uAC00 \uCD94\uAC00\uB41C PDF \uC800\uC7A5 \uC911...");let t=yield f.save();console.log("PDF \uC800\uC7A5 \uC644\uB8CC, \uD06C\uAE30:",t.length);let b=new Blob([t],{type:"application/pdf"}),p=URL.createObjectURL(b);return console.log("\uBC30\uACBD\uC0C9 \uC624\uBC84\uB808\uC774\uAC00 \uCD94\uAC00\uB41C PDF \uC900\uBE44 \uC644\uB8CC"),{success:!0,removedCount:u,modifiedPages:h,newPdfBlob:b,newPdfUrl:p}}catch(n){return console.error("\uBC30\uACBD\uC0C9 \uC624\uBC84\uB808\uC774 \uC2E4\uD328:",n),{success:!1,removedCount:0,modifiedPages:[],error:n instanceof Error?n.message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4."}}})}groupTextItemsForEditing(r){if(r.length===0)return[];let e=r.filter(n=>n.text&&n.text.trim().length>0).sort((n,s)=>{let f=n.transform[5],h=s.transform[5];return Math.abs(f-h)<5?n.transform[4]-s.transform[4]:h-f}),l=[],o=[],c=null,i=null;for(let n of e){let s=n.transform[5],f=n.transform[4],h=Math.abs(n.transform[0]);if((c===null||Math.abs(s-c)>h*1.5||Math.abs(s-c)<5&&i!==null&&f-i>h*3)&&o.length>0){let t=this.calculateGroupBounds(o);l.push(H(N({},t),{items:[...o],text:o.map(b=>b.text).join(" ")})),o=[]}o.push(n),c=s,i=f+n.position.width}if(o.length>0){let n=this.calculateGroupBounds(o);l.push(H(N({},n),{items:[...o],text:o.map(s=>s.text).join(" ")}))}return console.log(`\uD14D\uC2A4\uD2B8 \uADF8\uB8F9\uD654 \uC644\uB8CC: ${r.length}\uAC1C \uD56D\uBAA9 \u2192 ${l.length}\uAC1C \uADF8\uB8F9`),l}calculateGroupBounds(r){if(r.length===0)return{x:0,y:0,width:0,height:0};let e=1/0,l=-1/0,o=1/0,c=-1/0,i=0;for(let f of r){let h=f.transform[4],u=f.transform[5],t=f.position.width,b=Math.abs(f.transform[0]);e=Math.min(e,h),l=Math.max(l,h+t),o=Math.min(o,u),c=Math.max(c,u),i=Math.max(i,b)}let n=i*1.2,s=i*.2;return{x:e-3,y:o-s,width:l-e+6,height:n+(c-o)}}createEditableTextOverlay(r,e){return T(this,null,function*(){try{console.log("\uD3B8\uC9D1 \uAC00\uB2A5\uD55C \uD14D\uC2A4\uD2B8 \uC624\uBC84\uB808\uC774 \uC0DD\uC131 \uC2DC\uC791...");let l=yield this.waitForPDFLib(),o=yield r.arrayBuffer(),c=yield l.PDFDocument.load(o);console.log("PDF \uBB38\uC11C \uB85C\uB4DC \uC644\uB8CC, \uD398\uC774\uC9C0 \uC218:",c.getPageCount());let i=[],n=0;for(let u of e.pages)if(u.textItems.length>0){let t=u.pageNumber-1;if(t<c.getPageCount()){let b=c.getPages()[t];console.log(`\uD398\uC774\uC9C0 ${u.pageNumber}: \uD3B8\uC9D1 \uC624\uBC84\uB808\uC774 \uC0DD\uC131`);let p=this.groupTextItemsForEditing(u.textItems);console.log(`\uD398\uC774\uC9C0 ${u.pageNumber}: ${p.length}\uAC1C \uD14D\uC2A4\uD2B8 \uADF8\uB8F9 \uC0DD\uC131`);for(let m of p)try{console.log(`\uADF8\uB8F9 \uCC98\uB9AC: "${m.text.substring(0,30)}..." (${m.items.length}\uAC1C \uD14D\uC2A4\uD2B8)`),b.drawRectangle({x:m.x,y:m.y,width:m.width,height:m.height,color:l.rgb(1,1,1),opacity:.8,borderColor:l.rgb(0,0,1),borderWidth:.5,borderOpacity:.9}),b.drawRectangle({x:m.x,y:m.y,width:m.width,height:m.height,color:l.rgb(.95,.95,.95),opacity:.2,borderColor:l.rgb(0,.8,0),borderWidth:1,borderOpacity:.7}),n++}catch(B){console.warn(`\uD398\uC774\uC9C0 ${u.pageNumber}\uC758 \uADF8\uB8F9 \uC624\uBC84\uB808\uC774 \uC2E4\uD328:`,B)}i.push(u.pageNumber),console.log(`\uD398\uC774\uC9C0 ${u.pageNumber}\uC5D0 \uD3B8\uC9D1 \uC624\uBC84\uB808\uC774 \uCD94\uAC00 \uC644\uB8CC`)}}if(n===0)return{success:!1,removedCount:0,modifiedPages:[],error:"\uD3B8\uC9D1 \uC624\uBC84\uB808\uC774\uD560 \uD14D\uC2A4\uD2B8\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4."};console.log("\uD3B8\uC9D1 \uC624\uBC84\uB808\uC774\uAC00 \uCD94\uAC00\uB41C PDF \uC800\uC7A5 \uC911...");let s=yield c.save();console.log("PDF \uC800\uC7A5 \uC644\uB8CC, \uD06C\uAE30:",s.length);let f=new Blob([s],{type:"application/pdf"}),h=URL.createObjectURL(f);return console.log("\uD3B8\uC9D1 \uC624\uBC84\uB808\uC774\uAC00 \uCD94\uAC00\uB41C PDF \uC900\uBE44 \uC644\uB8CC"),{success:!0,removedCount:n,modifiedPages:i,newPdfBlob:f,newPdfUrl:h}}catch(l){return console.error("\uD3B8\uC9D1 \uC624\uBC84\uB808\uC774 \uC0DD\uC131 \uC2E4\uD328:",l),{success:!1,removedCount:0,modifiedPages:[],error:l instanceof Error?l.message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4."}}})}createSentenceGroupOverlay(r,e){return T(this,null,function*(){try{console.log("\uBB38\uC7A5 \uB2E8\uC704 \uC624\uBC84\uB808\uC774 \uC0DD\uC131 \uC2DC\uC791...");let l=yield this.waitForPDFLib(),o=yield r.arrayBuffer(),c=yield l.PDFDocument.load(o);console.log("PDF \uBB38\uC11C \uB85C\uB4DC \uC644\uB8CC, \uD398\uC774\uC9C0 \uC218:",c.getPageCount());let i=[],n=0,s=[],f=e.pages.find(b=>b.pageNumber===1);if(f&&f.textItems.length>0){let b=c.getPages()[0];console.log(`\uD398\uC774\uC9C0 1: \uBB38\uC7A5 \uB2E8\uC704 \uC624\uBC84\uB808\uC774 \uC0DD\uC131 (\uCD1D ${e.pages.length}\uD398\uC774\uC9C0 \uC911 \uCCAB \uD398\uC774\uC9C0\uB9CC \uCC98\uB9AC)`);let p=this.groupTextItemsBySentence(f.textItems);console.log(`\uD398\uC774\uC9C0 1: ${p.length}\uAC1C \uBB38\uC7A5 \uADF8\uB8F9 \uC0DD\uC131`);for(let m of p)try{console.log(`\uBB38\uC7A5 \uADF8\uB8F9 \uCC98\uB9AC: "${m.text.substring(0,50)}..." (${m.items.length}\uAC1C \uD14D\uC2A4\uD2B8)`),n++,s.push({id:n,pageNumber:1,text:m.text,position:{x:m.x,y:m.y,width:m.width,height:m.height},fontSize:m.items.length>0?Math.abs(m.items[0].transform[0]):12,itemCount:m.items.length,items:m.items})}catch(B){console.error("\uBB38\uC7A5 \uADF8\uB8F9 \uCC98\uB9AC \uC911 \uC624\uB958:",B)}i.push(1)}else console.log("\uCCAB \uBC88\uC9F8 \uD398\uC774\uC9C0\uC5D0 \uCC98\uB9AC\uD560 \uD14D\uC2A4\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.");if(n===0)return{success:!1,removedCount:0,modifiedPages:[],error:"\uCCAB \uBC88\uC9F8 \uD398\uC774\uC9C0\uC5D0\uC11C \uBB38\uC7A5 \uC624\uBC84\uB808\uC774\uD560 \uD14D\uC2A4\uD2B8\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4."};console.log("\uBB38\uC7A5 \uC624\uBC84\uB808\uC774\uAC00 \uCD94\uAC00\uB41C PDF \uC800\uC7A5 \uC911...");let h=yield c.save();console.log("PDF \uC800\uC7A5 \uC644\uB8CC, \uD06C\uAE30:",h.length);let u=new Blob([h],{type:"application/pdf"}),t=URL.createObjectURL(u);return console.log("\uCCAB \uBC88\uC9F8 \uD398\uC774\uC9C0\uC5D0 \uBB38\uC7A5 \uC624\uBC84\uB808\uC774\uAC00 \uCD94\uAC00\uB41C PDF \uC900\uBE44 \uC644\uB8CC"),console.log("\uC0DD\uC131\uB41C \uD14D\uC2A4\uD2B8 \uADF8\uB8F9 JSON \uB370\uC774\uD130:",JSON.stringify(s,null,2)),{success:!0,removedCount:n,modifiedPages:i,newPdfBlob:u,newPdfUrl:t,textGroups:s}}catch(l){return console.error("\uBB38\uC7A5 \uC624\uBC84\uB808\uC774 \uC0DD\uC131 \uC2E4\uD328:",l),{success:!1,removedCount:0,modifiedPages:[],error:l instanceof Error?l.message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4."}}})}groupTextItemsBySentence(r){if(r.length===0)return[];let e=r.filter(n=>n.text&&n.text.trim().length>0).sort((n,s)=>{let f=n.transform[5],h=s.transform[5];return Math.abs(f-h)<3?n.transform[4]-s.transform[4]:h-f}),l=[],o=[],c=null,i=null;for(let n of e){let s=n.transform[5],f=Math.abs(n.transform[0]);if((c===null||Math.abs(s-c)>f*.8||i!==null&&Math.abs(f-i)>1)&&o.length>0){let u=this.calculateSingleLineBounds(o);l.push(H(N({},u),{items:[...o],text:o.map(t=>t.text).join(" ")})),o=[]}o.push(n),c=s,i=f}if(o.length>0){let n=this.calculateSingleLineBounds(o);l.push(H(N({},n),{items:[...o],text:o.map(s=>s.text).join(" ")}))}return console.log(`\uD55C \uC904 \uB2E8\uC704 \uBB38\uC7A5 \uADF8\uB8F9\uD654 \uC644\uB8CC: ${r.length}\uAC1C \uD56D\uBAA9 \u2192 ${l.length}\uAC1C \uBB38\uC7A5 \uADF8\uB8F9`),l}calculateSingleLineBounds(r){if(r.length===0)return{x:0,y:0,width:0,height:0};let e=1/0,l=-1/0,o=0,c=0;c=Math.abs(r[0].transform[0]);for(let s of r){let f=s.transform[4],h=s.transform[5],u=s.position.width;e=Math.min(e,f),l=Math.max(l,f+u),o+=h}o=o/r.length;let i=c*1.2,n=c*.2;return{x:e-3,y:o-n,width:l-e+6,height:i}}saveTextOverlay(r,e,l=1){return T(this,null,function*(){try{console.log("\uAC1C\uBCC4 \uD14D\uC2A4\uD2B8 \uC624\uBC84\uB808\uC774 \uC800\uC7A5 \uC2DC\uC791...",e);let o=yield this.waitForPDFLib(),c=yield r.arrayBuffer(),i=yield o.PDFDocument.load(c);console.log("PDF \uBB38\uC11C \uB85C\uB4DC \uC644\uB8CC, \uD398\uC774\uC9C0 \uC218:",i.getPageCount());let n=(e.pageNumber||1)-1;if(n>=i.getPageCount()||n<0)throw new Error(`\uC798\uBABB\uB41C \uD398\uC774\uC9C0 \uBC88\uD638: ${e.pageNumber}`);let s=i.getPages()[n],{width:f,height:h}=s.getSize(),u,t,b,p;if(e.pdfCoords)u=e.pdfCoords.x,t=e.pdfCoords.y,b=e.pdfCoords.width,p=e.pdfCoords.height,console.log("\uC6D0\uBCF8 PDF \uC88C\uD45C \uC0AC\uC6A9:",e.pdfCoords);else{let d=f/595.276,F=h/841.89;u=e.x/1.3*d,t=h-e.y/1.3*F-e.height/1.3*F,b=e.width/1.3*d,p=e.height/1.3*F,console.log("\uBDF0\uC5B4 \uC88C\uD45C\uC5D0\uC11C \uBCC0\uD658:",{config:e,converted:{pdfX:u,pdfY:t,pdfWidth:b,pdfHeight:p}})}if(console.log("\uCD5C\uC885 PDF \uC88C\uD45C:",{x:u,y:t,width:b,height:p,page:{width:f,height:h}}),s.drawRectangle({x:u,y:t,width:b,height:p,color:o.rgb(1,1,1),opacity:1}),e.text&&e.text.trim().length>0){let x=e.font?.size||12,P=o.rgb(0,0,0);if(e.font?.color){let d=this.parseColor(e.font.color);P=o.rgb(d.r,d.g,d.b)}if(/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(e.text)){console.log("\uD55C\uAE00 \uD14D\uC2A4\uD2B8 \uAC10\uC9C0\uB428. \uD3B8\uC9D1\uB41C \uB0B4\uC6A9\uC744 \uBC30\uACBD\uC73C\uB85C \uD45C\uC2DC\uD569\uB2C8\uB2E4."),s.drawRectangle({x:u,y:t,width:b,height:p,color:o.rgb(1,1,1),opacity:.8});try{let d=t+x*.25,F=!1;if(yield this.loadKoreanFont(),this.fontData)try{i.registerFontkit(window.fontkit);let w;if(e.font?.weight==="bold")try{let y=yield this.loadKoreanBoldFont();y?w=yield i.embedFont(new Uint8Array(y)):w=yield i.embedFont(new Uint8Array(this.fontData))}catch{w=yield i.embedFont(new Uint8Array(this.fontData))}else w=yield i.embedFont(new Uint8Array(this.fontData));let a={x:u+2,y:d,size:x,font:w,color:P,maxWidth:b-4};e.font?.letterSpacing&&(a.wordSpacing=e.font.letterSpacing),s.drawText(e.text,a),F=!0,console.log(`fontkit\uC73C\uB85C \uD55C\uAE00 \uB80C\uB354\uB9C1 \uC131\uACF5: "${e.text}", \uD3F0\uD2B8: ${e.font?.name}, \uD06C\uAE30: ${x}, \uC0C9\uC0C1: ${e.font?.color||"black"}, \uAD75\uAE30: ${e.font?.weight||"normal"}`)}catch(w){console.warn("fontkit \uD55C\uAE00 \uD3F0\uD2B8 \uB80C\uB354\uB9C1 \uC2E4\uD328:",w)}if(!F)try{let w=document.createElement("canvas"),a=w.getContext("2d");if(a){w.width=Math.max(b,200),w.height=Math.max(p,50),a.fillStyle="white",a.fillRect(0,0,w.width,w.height);let y="";e.font?.style==="italic"&&(y+="italic "),e.font?.weight==="bold"&&(y+="bold ");let g='"\uB9D1\uC740 \uACE0\uB515", "Malgun Gothic", "Apple SD Gothic Neo", "\uB098\uB214\uACE0\uB515", "NanumGothic"';if(e.font?.name){let I=e.font.name.toLowerCase();I.includes("nanum")||I.includes("\uB098\uB214")?g='"\uB098\uB214\uACE0\uB515", "NanumGothic", '+g:I.includes("pretendard")?g='"Pretendard Variable", "Pretendard", '+g:I.includes("noto")&&(g='"Noto Sans KR", '+g)}g+=", Arial, sans-serif",a.font=`${y}${x}px ${g}`,e.font?.color?a.fillStyle=e.font.color:a.fillStyle="black",a.textBaseline="middle",a.textAlign="left",a.imageSmoothingEnabled=!0,e.font?.letterSpacing&&(a.letterSpacing=`${e.font.letterSpacing}px`),a.fillText(e.text,5,w.height/2);let S=w.toDataURL("image/jpeg",.95).split(",")[1],C=Uint8Array.from(atob(S),I=>I.charCodeAt(0)),k=yield i.embedJpg(C);s.drawImage(k,{x:u,y:t,width:b,height:p}),F=!0,console.log(`Canvas\uB85C \uD55C\uAE00 \uB80C\uB354\uB9C1 \uC131\uACF5: "${e.text}", \uD3F0\uD2B8: ${e.font?.name}, \uD06C\uAE30: ${x}, \uC0C9\uC0C1: ${e.font?.color||"black"}, \uAD75\uAE30: ${e.font?.weight||"normal"}, \uC2A4\uD0C0\uC77C: ${e.font?.style||"normal"}`)}}catch(w){console.warn("Canvas \uD55C\uAE00 \uB80C\uB354\uB9C1 \uC2E4\uD328:",w)}if(!F)try{let w=yield i.embedFont(o.StandardFonts.Helvetica),a=`[\uD3B8\uC9D1\uB428] ${e.text.length}\uAE00\uC790`;s.drawText(a,{x:u+2,y:d,size:Math.max(x*.8,10),font:w,color:P,maxWidth:b-4}),console.log(`\uD55C\uAE00 \uB300\uCCB4 \uD45C\uC2DC: "${e.text}" -> "${a}", \uC0C9\uC0C1: ${e.font?.color||"black"}`)}catch(w){console.error("\uB300\uCCB4 \uD14D\uC2A4\uD2B8 \uD45C\uC2DC\uB3C4 \uC2E4\uD328:",w)}}catch(d){console.error("\uB9C8\uCEE4 \uD14D\uC2A4\uD2B8 \uD45C\uC2DC \uC2E4\uD328:",d)}}else try{let d="Helvetica";if(e.font?.name){let y=e.font.name.toLowerCase();y.includes("times")?d=e.font.weight==="bold"?"Times-Bold":"Times-Roman":y.includes("courier")?d=e.font.weight==="bold"?"Courier-Bold":"Courier":(y.includes("helvetica")||y.includes("arial"),d=e.font.weight==="bold"?"Helvetica-Bold":"Helvetica")}e.font?.style==="italic"&&(d.includes("Times")?d=e.font.weight==="bold"?"Times-BoldItalic":"Times-Italic":d.includes("Helvetica")?d=e.font.weight==="bold"?"Helvetica-BoldOblique":"Helvetica-Oblique":d.includes("Courier")&&(d=e.font.weight==="bold"?"Courier-BoldOblique":"Courier-Oblique"));let F=yield i.embedFont(o.StandardFonts[d]||o.StandardFonts.Helvetica),w=t+p*.2,a={x:u+2,y:w,size:x,font:F,color:P,maxWidth:b-4};e.font?.letterSpacing&&(a.wordSpacing=e.font.letterSpacing),s.drawText(e.text,a),console.log(`\uC601\uBB38 \uD14D\uC2A4\uD2B8 \uC624\uBC84\uB808\uC774 \uCD94\uAC00: "${e.text}" at (${u}, ${w}), \uD3F0\uD2B8: ${d}, \uD06C\uAE30: ${x}, \uC0C9\uC0C1: ${e.font?.color||"black"}, \uAD75\uAE30: ${e.font?.weight||"normal"}, \uC2A4\uD0C0\uC77C: ${e.font?.style||"normal"}`)}catch(d){console.warn("\uD14D\uC2A4\uD2B8 \uB80C\uB354\uB9C1 \uC2E4\uD328:",d),s.drawRectangle({x:u,y:t,width:b,height:p,color:o.rgb(.9,.9,.9),opacity:.8})}}console.log("\uC624\uBC84\uB808\uC774\uAC00 \uCD94\uAC00\uB41C PDF \uC800\uC7A5 \uC911...");let m=yield i.save();console.log("PDF \uC800\uC7A5 \uC644\uB8CC, \uD06C\uAE30:",m.length);let B=new Blob([m],{type:"application/pdf"}),v=URL.createObjectURL(B);return console.log("\uAC1C\uBCC4 \uD14D\uC2A4\uD2B8 \uC624\uBC84\uB808\uC774 \uC800\uC7A5 \uC644\uB8CC"),{success:!0,removedCount:1,modifiedPages:[e.pageNumber||1],newPdfBlob:B,newPdfUrl:v}}catch(o){return console.error("\uAC1C\uBCC4 \uD14D\uC2A4\uD2B8 \uC624\uBC84\uB808\uC774 \uC800\uC7A5 \uC2E4\uD328:",o),{success:!1,removedCount:0,modifiedPages:[],error:o instanceof Error?o.message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4."}}})}saveMultipleTextOverlays(r,e,l=1){return T(this,null,function*(){try{console.log("\uC5EC\uB7EC \uD14D\uC2A4\uD2B8 \uC624\uBC84\uB808\uC774 \uC800\uC7A5 \uC2DC\uC791...",e.length,"\uAC1C");let o=yield this.waitForPDFLib(),c=yield r.arrayBuffer(),i=yield o.PDFDocument.load(c);console.log("PDF \uBB38\uC11C \uB85C\uB4DC \uC644\uB8CC, \uD398\uC774\uC9C0 \uC218:",i.getPageCount());let n=[],s=0;for(let t of e){let b=(t.pageNumber||1)-1;if(b>=i.getPageCount()||b<0){console.warn(`\uC798\uBABB\uB41C \uD398\uC774\uC9C0 \uBC88\uD638: ${t.pageNumber}, \uAC74\uB108\uB700`);continue}let p=i.getPages()[b],{width:m,height:B}=p.getSize(),v,x,P,$;if(t.pdfCoords)v=t.pdfCoords.x,x=t.pdfCoords.y,P=t.pdfCoords.width,$=t.pdfCoords.height,console.log(`\uC624\uBC84\uB808\uC774 ${s+1}/${e.length} - \uC6D0\uBCF8 PDF \uC88C\uD45C \uC0AC\uC6A9:`,t.pdfCoords);else{let a=m/595.276,y=B/841.89;v=t.x/1.3*a,x=B-t.y/1.3*y-t.height/1.3*y,P=t.width/1.3*a,$=t.height/1.3*y,console.log(`\uC624\uBC84\uB808\uC774 ${s+1}/${e.length} - \uBDF0\uC5B4 \uC88C\uD45C\uC5D0\uC11C \uBCC0\uD658:`,{config:t,converted:{pdfX:v,pdfY:x,pdfWidth:P,pdfHeight:$}})}if(console.log(`\uC624\uBC84\uB808\uC774 ${s+1}/${e.length} \uCC98\uB9AC:`,{text:t.text?.substring(0,30)+"...",viewer:{x:t.x,y:t.y,width:t.width,height:t.height},pdf:{x:v,y:x,width:P,height:$}}),p.drawRectangle({x:v,y:x,width:P,height:$,color:o.rgb(1,1,1),opacity:1}),t.text&&t.text.trim().length>0){let d=t.font?.size||12,F=o.rgb(0,0,0);if(t.font?.color){let a=this.parseColor(t.font.color);F=o.rgb(a.r,a.g,a.b)}if(/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(t.text)){console.log(`\uD55C\uAE00 \uD14D\uC2A4\uD2B8 \uAC10\uC9C0 (${t.id}): \uD3B8\uC9D1\uB41C \uB0B4\uC6A9\uC744 \uBC30\uACBD\uC73C\uB85C \uD45C\uC2DC\uD569\uB2C8\uB2E4.`),p.drawRectangle({x:v,y:x,width:P,height:$,color:o.rgb(1,1,1),opacity:.8});try{let a=x+d*.25,y=!1;if(yield this.loadKoreanFont(),this.fontData)try{i.registerFontkit(window.fontkit);let g;if(t.font?.weight==="bold")try{let S=yield this.loadKoreanBoldFont();S?g=yield i.embedFont(new Uint8Array(S)):g=yield i.embedFont(new Uint8Array(this.fontData))}catch{g=yield i.embedFont(new Uint8Array(this.fontData))}else g=yield i.embedFont(new Uint8Array(this.fontData));let D={x:v+2,y:a,size:d,font:g,color:F,maxWidth:P-4};t.font?.letterSpacing&&(D.wordSpacing=t.font.letterSpacing),p.drawText(t.text,D),y=!0,console.log(`fontkit\uC73C\uB85C \uD55C\uAE00 \uB80C\uB354\uB9C1 \uC131\uACF5 (${t.id}): "${t.text}", \uD3F0\uD2B8: ${t.font?.name}, \uD06C\uAE30: ${d}, \uC0C9\uC0C1: ${t.font?.color||"black"}, \uAD75\uAE30: ${t.font?.weight||"normal"}`)}catch(g){console.warn(`fontkit \uD55C\uAE00 \uD3F0\uD2B8 \uB80C\uB354\uB9C1 \uC2E4\uD328 (${t.id}):`,g)}if(!y)try{let g=document.createElement("canvas"),D=g.getContext("2d");if(D){g.width=Math.max(P,200),g.height=Math.max($,50),D.fillStyle="white",D.fillRect(0,0,g.width,g.height);let S="";t.font?.style==="italic"&&(S+="italic "),t.font?.weight==="bold"&&(S+="bold ");let C='"\uB9D1\uC740 \uACE0\uB515", "Malgun Gothic", "Apple SD Gothic Neo", "\uB098\uB214\uACE0\uB515", "NanumGothic"';if(t.font?.name){let G=t.font.name.toLowerCase();G.includes("nanum")||G.includes("\uB098\uB214")?C='"\uB098\uB214\uACE0\uB515", "NanumGothic", '+C:G.includes("pretendard")?C='"Pretendard Variable", "Pretendard", '+C:G.includes("noto")&&(C='"Noto Sans KR", '+C)}C+=", Arial, sans-serif",D.font=`${S}${d}px ${C}`,t.font?.color?D.fillStyle=t.font.color:D.fillStyle="black",D.textBaseline="middle",D.textAlign="left",D.imageSmoothingEnabled=!0,t.font?.letterSpacing&&(D.letterSpacing=`${t.font.letterSpacing}px`),D.fillText(t.text,5,g.height/2);let I=g.toDataURL("image/jpeg",.95).split(",")[1],U=Uint8Array.from(atob(I),G=>G.charCodeAt(0)),A=yield i.embedJpg(U);p.drawImage(A,{x:v,y:x,width:P,height:$}),y=!0,console.log(`Canvas\uB85C \uD55C\uAE00 \uB80C\uB354\uB9C1 \uC131\uACF5 (${t.id}): "${t.text}", \uD3F0\uD2B8: ${t.font?.name}, \uD06C\uAE30: ${d}, \uC0C9\uC0C1: ${t.font?.color||"black"}, \uAD75\uAE30: ${t.font?.weight||"normal"}, \uC2A4\uD0C0\uC77C: ${t.font?.style||"normal"}`)}}catch(g){console.warn(`Canvas \uD55C\uAE00 \uB80C\uB354\uB9C1 \uC2E4\uD328 (${t.id}):`,g)}if(!y){let g=yield i.embedFont(o.StandardFonts.Helvetica),D=`[\uD3B8\uC9D1: ${t.text}]`;p.drawText(D,{x:v+2,y:a,size:Math.min(d,10),font:g,color:F,maxWidth:P-4}),console.log(`\uD55C\uAE00 \uB300\uCCB4 \uD14D\uC2A4\uD2B8 \uD45C\uC2DC (${t.id}): "${t.text}" -> "${D}", \uC0C9\uC0C1: ${t.font?.color||"black"}`)}}catch(a){console.warn(`\uD55C\uAE00 \uD14D\uC2A4\uD2B8 \uB9C8\uCEE4 \uCD94\uAC00 \uC2E4\uD328 (${t.id}):`,a)}}else try{let a="Helvetica";if(t.font?.name){let S=t.font.name.toLowerCase();S.includes("times")?a=t.font.weight==="bold"?"Times-Bold":"Times-Roman":S.includes("courier")?a=t.font.weight==="bold"?"Courier-Bold":"Courier":(S.includes("helvetica")||S.includes("arial"),a=t.font.weight==="bold"?"Helvetica-Bold":"Helvetica")}t.font?.style==="italic"&&(a.includes("Times")?a=t.font.weight==="bold"?"Times-BoldItalic":"Times-Italic":a.includes("Helvetica")?a=t.font.weight==="bold"?"Helvetica-BoldOblique":"Helvetica-Oblique":a.includes("Courier")&&(a=t.font.weight==="bold"?"Courier-BoldOblique":"Courier-Oblique"));let y=yield i.embedFont(o.StandardFonts[a]||o.StandardFonts.Helvetica),g=x+d*.25,D={x:v+2,y:g,size:d,font:y,color:F,maxWidth:P-4};t.font?.letterSpacing&&(D.wordSpacing=t.font.letterSpacing),p.drawText(t.text,D),console.log(`\uC601\uBB38 \uD14D\uC2A4\uD2B8 \uB80C\uB354\uB9C1 \uC644\uB8CC (${t.id}): "${t.text}" at (${v+2}, ${g}), \uD3F0\uD2B8: ${a}, \uD06C\uAE30: ${d}, \uC0C9\uC0C1: ${t.font?.color||"black"}, \uAD75\uAE30: ${t.font?.weight||"normal"}, \uC2A4\uD0C0\uC77C: ${t.font?.style||"normal"}`)}catch(a){console.warn(`\uD14D\uC2A4\uD2B8 \uB80C\uB354\uB9C1 \uC2E4\uD328 (${t.id}):`,a),p.drawRectangle({x:v,y:x,width:P,height:$,color:o.rgb(.9,.9,.9),opacity:.8})}}s++,n.includes(t.pageNumber||1)||n.push(t.pageNumber||1)}if(s===0)return{success:!1,removedCount:0,modifiedPages:[],error:"\uCC98\uB9AC\uD560 \uC720\uD6A8\uD55C \uC624\uBC84\uB808\uC774\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4."};console.log(`${s}\uAC1C \uC624\uBC84\uB808\uC774\uAC00 \uCD94\uAC00\uB41C PDF \uC800\uC7A5 \uC911...`);let f=yield i.save();console.log("PDF \uC800\uC7A5 \uC644\uB8CC, \uD06C\uAE30:",f.length);let h=new Blob([f],{type:"application/pdf"}),u=URL.createObjectURL(h);return console.log("\uC5EC\uB7EC \uD14D\uC2A4\uD2B8 \uC624\uBC84\uB808\uC774 \uC800\uC7A5 \uC644\uB8CC"),{success:!0,removedCount:s,modifiedPages:n,newPdfBlob:h,newPdfUrl:u}}catch(o){return console.error("\uC5EC\uB7EC \uD14D\uC2A4\uD2B8 \uC624\uBC84\uB808\uC774 \uC800\uC7A5 \uC2E4\uD328:",o),{success:!1,removedCount:0,modifiedPages:[],error:o instanceof Error?o.message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4."}}})}static \u0275fac=function(e){return new(e||R)};static \u0275prov=L({token:R,factory:R.\u0275fac,providedIn:"root"})};export{E as a};
